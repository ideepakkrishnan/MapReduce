/**
 * 
 */
package com.neu.pdp.withCombiner;

import java.io.IOException;

import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Reducer;

import com.neu.pdp.resources.IntPair;
import com.neu.pdp.resources.MaxReading;
import com.neu.pdp.resources.MinReading;

/**
 * @author ideepakkrishnan
 *
 */
public class ReadingReducer extends Reducer<Text, IntPair, Text, Text> {
	
	private Text result = new Text();
	
	public void reduce(
			Text key, 
			Iterable<IntPair> values, 
            Context context) throws IOException, InterruptedException {
		// Local variables
		int tminSum = 0;
		int tminCount = 0;
		int tmaxSum = 0;
		int tmaxCount = 0;
		
		for (IntPair val : values) {
			if (val.getClass() == MinReading.class) {				
				tminSum += val.getFirst();
				tminCount += val.getSecond();
			} else if (val.getClass() == MaxReading.class) {
				tmaxCount += 1;
				tmaxSum += val.getSecond();
			}
		}
		
		result = new Text(
				", " + String.valueOf((tminCount == 0) ? 0 : tminSum / tminCount) + 
				", " + String.valueOf((tmaxCount == 0) ? 0 : tmaxSum / tmaxCount));
		
		context.write(key, result);
	}

}
